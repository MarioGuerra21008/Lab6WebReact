<!DOCTYPE html>
<html>
    <head>
        <title>Memory Card Game!</title>
        <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    </head>
    <body style="background-color: #a5f0dc;">
        <div id="root"></div>
        <script type="text/babel">
            
            const Front = () => {
                return(
                    <img src={'./FrontCard.png'} style={{
                        height: '100%',
                        width: '100%',
                        margin: '0px',
                        borderRadius: '1px',
                        position: 'absolute'
                    }}/>
                )
            }

            const Back = ({animalCard}) => {
                return(
                    <img src={animalCard} style={{
                        height: '100%',
                        width: '100%',
                        backfaceVisibility: 'hidden',
                        transform: 'rotateX(180deg)',
                        position: 'absolute'
                    }}/>
                )
            }

            const Template = (card, degree, onClick) => {
                let rotable = degree ? '180' : '0'
                return(
                    <div style={{
                        width: '100px',
                        height: '150px',
                        border: '10px solid #000000',
                        margin: 'auto auto',
                        transition: 'transform 500ms',
                        transform: 'rotateX('+rotable+'deg)',
                        cursor: 'pointer',
                        position: 'relative'
                    }}
                    onClick={onClick}>
                    <Back animalCard={card}/>
                    <Front/>
                    </div>
                );
            }

            const Victory = ({indeX}) => {
                return(
                    <div style={{
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center',
                        position: 'absolute',
                        color: 'white',
                        backgroundColor: '#a5f0dc',
                        zIndex: indeX,
                        fontSize: '50px'
                    }}>
                        <p>Felicidades! Completaste el juego!</p>
                        <button onClick={()=>{location.reload()}}>Jugar otra vez</button>
                    </div>
                )
            }

            const memoryCards = ({setScore, setMovement}) => {
                var CardList = [
                    'Cards/caballo.png',
                    'Cards/feneco.png',
                    'Cards/gato.png',
                    'Cards/mapache.png',
                    'Cards/pato.png',
                    'Cards/perro.png',
                    'Cards/tucan.png',
                    'Cards/vaca.png'
                ]
                const [rotar, setRotar] = React.useState(Array(16).fill(false))
                const randomizer = (maxRandomizer) => {
                    return Math.floor(Math.random() * maxRandomizer);
                };

                const RandList = CardList.slice();
                RandList.sort(() => {
                    return randomizer(2) - 1;
                });

                const [match, setMatch] = React.useState([])

                const puntaje = (newMatch) => {
                    console.log(newMatch)

                    if (newMatch.length > 1) {
                        setMovement()
                        if (imagen.current[newMatch[0]] === imagen.current[newMatch[1]]) {
                            setScore()
                        }
                        else {
                            setReturn(() => {
                                setRotar(prevState => {
                                    const newRotar = [...prevState]
                                    newRotar[newMatch[1]] = !newRotar[newMatch[1]]
                                    newRotar[newMatch[0]] = !newRotar[newMatch[0]]
                                    return newRotar
                                })
                            },500)
                        }
                        setMatch([])
                    }
                }

                const imagen = React.useRef([...RandList])
                const click = (index) => {
                    if(rotar[index] !== true) {
                        setRotar(prevState => {
                            const newRotar = [...prevState]
                            newRotar[index] = !newRotar[index]
                            return newRotar
                        })
                        setMatch(prevState => {
                            const newMatch = [...prevState]
                            newMatch.push(index)
                            puntaje(newMatch)
                            return newMatch
                        })
                    }
                }

                return(
                    <div style={{
                        width: '1000px',
                        height: '1000px',
                        margin: 'auto',
                        display: 'grid',
                        gridTemplateColumns: 'repeat(4, 150px)',
                        gridTemplateColumns: 'repeat(4, 150px)'
                    }}> {
                        imagen.current.map((item, index) => (
                            <Template key={index} card={item} onClick={() => click(index)} degree={rotar[index]}/>
                        ))
                    }
                    </div>
                )
            }

            const MemoryCardsGameplay = () => {
                const [score,setScore] = React.useState(0)
                const [indeX, setIndeX] = React.useState(0)
                const [movement, setMovement] = React.useState(0)

                const puntuacion = () => {
                    setScore(prevState => {
                        if((prevState+1)>=8) {
                            setTimeout(() => {setIndeX(2)}, 500)
                            setIndeX(2)
                        }
                        return prevState + 1
                    })
                }

                return(
                    <div style={{
                        width: '100%',
                        height: '100%',
                        background: 'linear-gradient(27deg, #151515 5px, transparent 5px) 0 5px, linear-gradient(207deg, #151515 5px, transparent 5px) 10px 0px, linear-gradient(27deg, #222 5px, transparent 5px) 0px 10px, linear-gradient(207deg, #222 5px, transparent 5px) 10px 5px, linear-gradient(90deg, #1b1b1b 10px, transparent 10px), linear-gradient(#1d1d1d 25%, #1a1a1a 25%, #1a1a1a 50%, transparent 50%, transparent 75%, #242424 75%, #242424)',
                        backgroundColor: '#a5f0dc',
                        backgroundSize: '15px 15px',
                        margin: '0px 0px'
                    }}>

                        <div style={{
                            position: 'relative',
                            display: 'flex',
                            justifyContent: 'bottom',
                            alignItems: 'center',
                            indeX: 3
                        }}>
                            <h3>Puntos: {score}</h3>
                            <h3>Movimientos: {movement}</h3>
                        </div>

                        <div style={{
                            position: 'relative',
                            indeX: 1
                        }}>
                            <memoryCards setScore={() => {puntuacion()}} setMovement = {() => setMovement(movement+1)}/>
                        </div>

                        <Victory indeX={indeX}></Victory>
                    </div>
                )
            }

            const root = ReactDOM.createRoot(document.getElementById('root'))
            root.render(<MemoryCardsGameplay />)
        </script>
    </body>
</html>